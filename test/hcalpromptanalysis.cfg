process DTGREN  = {


  include "CondCore/DBCommon/data/CondDBSetup.cfi"

############################################################################################	
#			F I L E   R E A D E R 
############################################################################################	

# Event Formatter
  untracked PSet maxEvents = {
#    untracked int32 input = 19600
    untracked int32 input = -1 
#    untracked int32 input = 2000 	
  }


# ======================================================
# 1) choose here your Input data 
# ======================================================

# global runs:
  source = PoolSource {
    untracked string fileMatchMode = "permissive"
      untracked uint32 firstRun = 0
      untracked uint32 firstEvent = 0
      untracked uint32 skipEvents = 0
#      untracked vstring fileNames = {'/store/data/GlobalSep07/A/000/020/734/RAW/0000/0294755E-276D-DC11-AC53-000423D69D4A.root'}
#      untracked vstring fileNames = {'file:/tmp/ugasp/DTHcal_r28835_1.root'}
 untracked vstring fileNames = {
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/0C3C47B7-E5A4-DC11-B9DA-000423D94DE8.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/34D317AD-E7A4-DC11-BE0F-001617DBD49E.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/3604EA55-E9A4-DC11-9761-00304885B41C.root',
#                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/40CBB500-E8A4-DC11-BB8F-001617DBD25A.root',
#                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/4AE9889E-E5A4-DC11-9505-001617DBD2FA.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/4CF7DDB0-E6A4-DC11-87C0-000423D665B2.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/5EE3AB39-E7A4-DC11-BBA8-00304885B4C8.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/60BA58C1-E8A4-DC11-977D-001617C3B652.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/620E3735-E6A4-DC11-9FF3-003048562914.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/68B11A6F-E8A4-DC11-B264-000423D6101A.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/6A8A6ED8-E6A4-DC11-9C97-001617C3B614.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/747B038F-E6A4-DC11-9189-00304885AAC4.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/86B2A6A8-E5A4-DC11-A7D4-000E0C3F097F.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/8A9CA88E-E7A4-DC11-9076-001617DBD558.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/9434A415-E6A4-DC11-9B9B-000423D994CC.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/9A300385-E8A4-DC11-8599-001617DBD356.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/9A5811CF-E5A4-DC11-9F16-001617C3B652.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/A88B695A-E9A4-DC11-901A-001617DBCFB0.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/ACAB6E50-E8A4-DC11-A851-00304885B32C.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/B8302343-E7A4-DC11-8A6C-000423D6B1A4.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/CABC551F-EAA4-DC11-BCDE-000423D567F0.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/DC3C3D41-E5A4-DC11-B3CF-00304885AAC8.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/DE038C1C-E8A4-DC11-BD69-000423DD3410.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/DE652DAF-E8A4-DC11-88F0-000423D94C80.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/DE79328E-E6A4-DC11-88F7-000423D94EA0.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/E0B85861-E8A4-DC11-8A1E-001617C3B66A.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/E4434767-E7A4-DC11-B281-001617DBD5C4.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/E814CDF1-E8A4-DC11-ADE4-001617C3B77E.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/FAA5EF17-E9A4-DC11-BFF2-001617DBD558.root',
                                 'rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/625/RAW/0000/FC2F0659-E7A4-DC11-AB14-000423D59C46.root'
                               }
# untracked vstring fileNames = {'file:/tmp/akub19/run29360.root' }
  }



# ===========================================================
# 2) Configure here the Data Unpacker
# =========================================================== 


 module dtunpacker = DTUnpackingModule {
    string dataType = "DDU"
    untracked bool fedbyType = true
    untracked bool useStandardFEDid = true
    PSet readOutParameters  = {
        untracked bool localDAQ = false
        untracked bool performDataIntegrityMonitor = false
        untracked bool debug = false
        PSet rosParameters = {
            untracked bool localDAQ = false
            untracked bool readingDDU = true
            untracked bool writeSC = true
            untracked bool readDDUIDfromDDU = true
            untracked bool performDataIntegrityMonitor = false
            untracked bool debug = false
        }
    }
 }

  module hcalZeroSuppressedDigis = HcalRawToDigi {
    InputTag InputLabel = source
    int32 firstSample = 0
    int32 lastSample = 9
    bool FilterDataQuality = true
  }

# =================================    
# 3) Mapping & t0 calibs & DB stuff   
# =================================


    es_source DTMapping = PoolDBESSource {
	string timetype = "runnumber"
	string connect = "oracle://cms_orcoff/CMS_COND_ON_170_DT"
	untracked string catalog = "relationalcatalog_oracle://cms_orcoff/CMS_COND_GENERAL"
	untracked bool siteLocalConfig = false
	string record = "DTReadOutMappingRcd"
	string tag = "DTChannelsMap"
	PSet DBParameters = {
	    untracked int32 messageLevel = 0
	    untracked string authenticationPath = "/afs/cern.ch/cms/DB/conddb"
	}
	VPSet toGet = {
	    { string record = "DTReadOutMappingRcd"
                string tag = "GRENmap_774" },
	    { string record = "DTT0Rcd"
		string tag = "GRENt0" }  ,
           { string record = "DTTtrigRcd"
                string tag = "GRENttrigTest" }
	}
    }

#  include "CondCore/DBCommon/data/CondDBSetup.cfi"

  es_source hcalConditions = PoolDBESSource {
    string timetype = "runnumber"
    string connect = "frontier://Frontier/CMS_COND_ON_180_HCAL"
    PSet DBParameters = {
      untracked int32 messageLevel = 0
    }
    VPSet toGet = {
      { string record = "HcalPedestalsRcd" string tag = "hcal_pedestals_fC_v2_grmm" },
      { string record = "HcalElectronicsMapRcd" string tag = "official_emap_v5_080208" },
      { string record = "HcalGainsRcd" string tag = "hcal_gains_v2_gren_reprocessing" },	
      { string record = "HcalQIEDataRcd" string tag = "qie_normalmode_v3" },
      { string record = "HcalPedestalWidthsRcd" string tag = "hcal_widths_fC_v2_grmm" }
    }
    untracked bool siteLocalConfig = false
  }

  es_module hcal_db_producer = HcalDbProducer {
    untracked vstring dump = { "" }
  }
  es_source HCALCalibration = HcalHardcodeCalibrations {
    untracked vstring toGet = { "ChannelQuality", "GainWidths" }
  }
   // to test different HCAL peds, can imput a ped text file here
//   es_source es_ascii = HcalTextCalibrations { VPSet input = {
//     {
//       string object = "Pedestals"
//       FileInPath file="pedsnew.txt"
//     }
 //  }
 //  }  
# ============================================
#  6) cfi's for reconstruction
# ============================================	
  
  module hbhereco = HcalSimpleReconstructor {
    InputTag digiLabel = hcalZeroSuppressedDigis
    string Subdetector = "HBHE"
    int32 firstSample = 1
    int32 samplesToAdd = 8
    bool correctForTimeslew = true
    bool correctForPhaseContainment = true
    double correctionPhaseNS = 10.0
  }
  module hfreco = HcalSimpleReconstructor {
    InputTag digiLabel = hcalZeroSuppressedDigis
    string Subdetector = "HF"
    int32 firstSample = 1
    int32 samplesToAdd = 8
    bool correctForTimeslew = true
    bool correctForPhaseContainment = true
    double correctionPhaseNS = 10.0
  }
  module horeco = HcalSimpleReconstructor {
    InputTag digiLabel = hcalZeroSuppressedDigis
    string Subdetector = "HO"
    int32 firstSample = 1
    int32 samplesToAdd = 8
    bool correctForTimeslew = true
    bool correctForPhaseContainment = true
    double correctionPhaseNS = 10.0
  }

       
#######   include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"
 #   include "Geometry/MuonCommonData/data/muonIdealGeometryXML.cfi"
    include "Geometry/DTGeometry/data/dtGeometry.cfi"
    include "Geometry/CSCGeometry/data/cscGeometry.cfi"
    include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"


    include "RecoLocalMuon/DTRecHit/data/dt1DRecHits_LinearDrift_CosmicData.cfi"
#   modified hit resolution
#    include "RecoLocalMuon/DTSegment/test/dt1DRecHits_LinearDrift_CosmicData.cfi"
#    replace double hitResolution = 0.06
    include "RecoLocalMuon/DTSegment/data/dt2DSegments_CombPatternReco2D_LinearDrift_CosmicData.cfi"
    include "RecoLocalMuon/DTSegment/data/dt4DSegments_CombPatternReco4D_LinearDrift_CosmicData.cfi"

    
       ## Geometry
    include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"
#    include "MagneticField/Engine/data/uniformMagneticField.cfi"
##    include "RecoLocalMuon/DTSegment/test/uniformMagneticField.cfi"
#  temporary....(and wrong!, just for 'formal' tests...)
    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

# es_prefer = UniformMagneticFieldESProducer{}

    include "RecoMuon/DetLayers/data/muonDetLayerGeometry.cfi"
    include "RecoMuon/MuonSeedGenerator/data/CosmicMuonSeedProducer.cfi"
    replace CosmicMuonSeed.EnableCSCMeasurement = false
    include "RecoMuon/CosmicMuonProducer/data/cosmicMuons.cfi"
    replace	cosmicMuons.TrajectoryBuilderParameters.EnableDTMeasurement = true
	replace cosmicMuons.TrajectoryBuilderParameters.EnableCSCMeasurement = false
	replace cosmicMuons.TrajectoryBuilderParameters.EnableRPCMeasurement = false
	#replace cosmicMuons.TrajectoryBuilderParameters.BackwardMuonTrajectoryUpdatorParameters.Granularity= 0

    module testDT = DTRecSegment4DReader {
        untracked bool debug = false
        untracked string rootFileName = 'dtsegments.root'
        string recHits4DLabel = 'dt4DSegments'
    }

//    module testHCAL = HcalrH {
//      untracked string histoFileName = 'tafasdfadsfest.root'
//    }
//@@
include "RecoJets/Configuration/data/RecoJets.cff"
include "RecoJets/Configuration/data/CaloTowersRec.cff"
//@@


    //Track Associator
    include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"
    include "Geometry/CaloEventSetup/data/CaloGeometry.cff"
    include "TrackingTools/TrackAssociator/data/DetIdAssociatorESProducer.cff"
    module test = CaloMatching {
       include "TA.cff"
       //InputTag inputRecoTrackColl = cosmicMuons
       string outputfile = "prompt.root"
    }

   ## propagation
   include "TrackPropagation/SteppingHelixPropagator/data/SteppingHelixPropagator.cfi"
   es_module = UniformMagneticFieldESProducer {
       double ZFieldInTesla = 0.0
   }
   es_prefer = UniformMagneticFieldESProducer {}

   //@@@
	sequence jetsGREN = {caloTowersRec, recoJets}
   //@@@

   service = MessageLogger {   untracked vstring suppressWarning = { "SteppingHelixPropagator", "test", "cosmicMuons" } }
#   path p = {dtunpacker,hcalZeroSuppressedDigis,hbhereco,horeco,hfreco,testHCAL,dt1DRecHits, dt2DSegments, dt4DSegments,CosmicMuonSeed, cosmicMuons,test}
 
path p = {dtunpacker,hcalZeroSuppressedDigis,hbhereco,horeco,hfreco,dt1DRecHits, dt2DSegments, dt4DSegments,CosmicMuonSeed, cosmicMuons,jetsGREN, test}



}

